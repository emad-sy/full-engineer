<script type="text/javascript">
/**
 * ุฅุบูุงู ูููุฐุฌ Google Forms ุจุนุฏ 36 ุฑุฏ
 * ุฅุนุฏุงุฏุงุช: ุฅุจุฑุงููู ุงูุชูู
 */
function closeFormAfterLimit() {
  // ========== โ๏ธ ุฅุนุฏุงุฏุงุช ุฅุจุฑุงููู ==========
  var MAX_RESPONSES = 36;          // 36 ุฑุฏ ูุญุฏ ุฃูุตู
  var CLOSE_MESSAGE = "โ ุชู ุงุณุชูุจุงู ุงูุนุฏุฏ ุงููุงูู ูู ุงูุฑุฏูุฏ (36 ุฑุฏ).\nุดูุฑุงู ููุดุงุฑูุชูู ูู ุงุณุชุจูุงู ุงูููุฆุฉ ุงูุทูุงุจูุฉ!";
  var NOTIFICATION_EMAIL = "ibrahimaltoom79@gmail.com"; // ุจุฑูุฏ ุฅุจุฑุงููู ููุฅุดุนุงุฑ
  // ========================================
  
  var form = FormApp.getActiveForm();
  var responses = form.getResponses();
  var responseCount = responses.length;
  
  // ๐ ุทุจุงุนุฉ ูุนูููุงุช ูููุฑุงูุจุฉ
  console.log("๐ ุนุฏุฏ ุงูุฑุฏูุฏ ุงูุญุงูู: " + responseCount + " ูู " + MAX_RESPONSES);
  console.log("๐ฏ ุงููุทููุจ: 36 ุฑุฏ | ุงููุชุจูู: " + (MAX_RESPONSES - responseCount));
  
  // ๐ ุงูุชุญูู ูุงุชุฎุงุฐ ุงูุฅุฌุฑุงุก
  if (responseCount >= MAX_RESPONSES) {
    if (form.isAcceptingResponses()) {
      form.setAcceptingResponses(false);
      console.log("โ ุชู ุฅุบูุงู ุงููููุฐุฌ ุชููุงุฆูุงู ุนูุฏ 36 ุฑุฏ");
      
      // ๐ ุฅุฑุณุงู ุฅุดุนุงุฑ ุจุงูุจุฑูุฏ ูุฅุจุฑุงููู
      if (NOTIFICATION_EMAIL) {
        try {
          MailApp.sendEmail({
            to: NOTIFICATION_EMAIL,
            subject: "๐ ุชู ุฅุบูุงู ูููุฐุฌ ุงูููุฆุฉ ุงูุทูุงุจูุฉ (36 ุฑุฏ)",
            body: "ุชูุงุตูู ุงูุฅุบูุงู:\n" +
                  "๐ ุงุณู ุงููููุฐุฌ: " + form.getTitle() + 
                  "\n๐ฅ ุนุฏุฏ ุงูุฑุฏูุฏ: " + responseCount + 
                  "\n๐ฏ ุงูุญุฏ ุงูุฃูุตู: " + MAX_RESPONSES +
                  "\n๐ ููุช ุงูุฅุบูุงู: " + new Date() +
                  "\n๐ ุฑุงุจุท ุงููููุฐุฌ: " + form.getEditUrl() +
                  "\n\nุชู ุฅุบูุงู ุงููููุฐุฌ ุชููุงุฆูุงู ุจูุงุณุทุฉ Google Apps Script"
          });
          console.log("๐ง ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฅุจุฑุงููู");
        } catch(e) {
          console.log("โ๏ธ ูู ูุชู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ: " + e.toString());
        }
      }
    }
  } else {
    var remaining = MAX_RESPONSES - responseCount;
    console.log("โณ ูุชุจูู: " + remaining + " ุฑุฏ ูููุตูู ุฅูู 36");
    
    // ุฅุดุนุงุฑ ุนูุฏ ุงูุงูุชุฑุงุจ ูู ุงูุญุฏ
    if (remaining <= 5) {
      console.log("โ๏ธ ุชุญุฐูุฑ: ูุชุจูู " + remaining + " ุฑุฏ ููุท!");
    }
  }
}

/**
 * โฐ ูุธููุฉ ููุญุต ุชููุงุฆู ูู 30 ุฏูููุฉ
 */
function setupAutoCheck() {
  // ุญุฐู ุฃู ูุญุฑูุงุช ูุฏููุฉ
  var triggers = ScriptApp.getProjectTriggers();
  triggers.forEach(function(trigger) {
    ScriptApp.deleteTrigger(trigger);
  });
  
  // ุฅูุดุงุก ูุญุฑู ุฌุฏูุฏ (ูู 30 ุฏูููุฉ)
  ScriptApp.newTrigger('closeFormAfterLimit')
    .timeBased()
    .everyMinutes(30)  // ูุญุต ูู ูุตู ุณุงุนุฉ
    .create();
  
  console.log("โ ุชู ุชูุนูู ุงููุญุต ุงูุชููุงุฆู ูู 30 ุฏูููุฉ");
  console.log("๐ฏ ุณูุชู ุฅุบูุงู ุงููููุฐุฌ ุนูุฏ ุงููุตูู ุฅูู 36 ุฑุฏ");
}

/**
 * โฐ ูุธููุฉ ููุญุต ุชููุงุฆู ูู 10 ุฏูุงุฆู (ูููุญุต ุงูุฏููู)
 */
function setupFrequentCheck() {
  var triggers = ScriptApp.getProjectTriggers();
  triggers.forEach(function(trigger) {
    ScriptApp.deleteTrigger(trigger);
  });
  
  ScriptApp.newTrigger('closeFormAfterLimit')
    .timeBased()
    .everyMinutes(10)  // ูุญุต ูู 10 ุฏูุงุฆู
    .create();
  
  console.log("โ ุชู ุชูุนูู ุงููุญุต ุงูุชููุงุฆู ูู 10 ุฏูุงุฆู");
}

/**
 * ๐ ุฅููุงู ุงููุญุต ุงูุชููุงุฆู
 */
function stopAutoCheck() {
  var triggers = ScriptApp.getProjectTriggers();
  triggers.forEach(function(trigger) {
    ScriptApp.deleteTrigger(trigger);
  });
  console.log("๐ ุชู ุฅููุงู ุงููุญุต ุงูุชููุงุฆู");
}

/**
 * ๐ ุฅุนุงุฏุฉ ูุชุญ ุงููููุฐุฌ ูุฏููุงู
 */
function reopenFormManually() {
  var form = FormApp.getActiveForm();
  form.setAcceptingResponses(true);
  console.log("๐ ุชู ุฅุนุงุฏุฉ ูุชุญ ุงููููุฐุฌ ูุฏููุงู");
  console.log("โ๏ธ ุณูุชู ุฅุบูุงูู ุชููุงุฆูุงู ุนูุฏ 36 ุฑุฏ");
}

/**
 * ๐ ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงููููุฐุฌ
 */
function showFormStats() {
  var form = FormApp.getActiveForm();
  var responses = form.getResponses();
  var isOpen = form.isAcceptingResponses();
  var remaining = 36 - responses.length;
  
  var stats = {
    "๐ ุงุณู ุงููููุฐุฌ": form.getTitle(),
    "๐ ุงูุญุงูุฉ": isOpen ? "โ ููุชูุญ" : "โ ูุบูู",
    "๐ฅ ุนุฏุฏ ุงูุฑุฏูุฏ": responses.length + "/36",
    "๐ฏ ุงููุชุจูู ูููุตูู ูู36": remaining > 0 ? remaining + " ุฑุฏ" : "โ ุชู ุงููุตูู",
    "๐ ุฃุญุฏุซ ุฑุฏ": responses.length > 0 ? responses[responses.length-1].getTimestamp() : "ูุง ููุฌุฏ",
    "โฐ ููุช ุงููุญุต ุงูุฃุฎูุฑ": new Date()
  };
  
  console.log("๐ ุฅุญุตุงุฆูุงุช ูููุฐุฌ ุงูููุฆุฉ ุงูุทูุงุจูุฉ:");
  console.log("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ");
  for (var key in stats) {
    console.log(key + ": " + stats[key]);
  }
  console.log("โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ");
  
  return stats;
}

/**
 * ๐ ุชุดุบูู ูุญุต ููุฑู + ุชูุนูู ุชููุงุฆู
 */
function initializeFormLimiter() {
  console.log("๐ ุจุฏุก ุฅุนุฏุงุฏ ูุญุฏุฏ ุงููููุฐุฌ ูู 36 ุฑุฏ");
  console.log("๐ง ุณูุชู ุงูุฅุดุนุงุฑ ุนูู: ibrahimaltoom79@gmail.com");
  
  // ูุญุต ููุฑู
  closeFormAfterLimit();
  
  // ุชูุนูู ุงููุญุต ุงูุชููุงุฆู ูู 30 ุฏูููุฉ
  setupAutoCheck();
  
  console.log("โ ุชู ุงูุฅุนุฏุงุฏ ุจูุฌุงุญ!");
  console.log("๐ฏ ุงููููุฐุฌ ุณููุบูู ุชููุงุฆูุงู ุนูุฏ 36 ุฑุฏ");
}</script>